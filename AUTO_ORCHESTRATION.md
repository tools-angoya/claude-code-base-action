# 自動タスクオーケストレーション機能

ClaudeCodeActionに実装された自動タスクオーケストレーション機能の詳細説明です。

## 概要

自動タスクオーケストレーション機能は、ユーザーの指示を自動分析し、適切なモード（architect/debug/ask/code/orchestrator）を判定して、複雑なタスクを複数のサブタスクに自動分解し、各サブタスクを適切なモードに委譲する機能です。

## 主要機能

### 1. タスク分析とモード判定 (`task-analyzer.ts`)

- **複雑度分析**: タスクの複雑さを自動評価
- **モード推奨**: 最適なモードを自動選択
- **サブタスク分解**: 複雑なタスクを管理可能な単位に分割

### 2. 自動オーケストレーション (`auto-orchestrator.ts`)

- **依存関係管理**: サブタスク間の依存関係を自動解決
- **並行実行**: 複数のサブタスクを効率的に実行
- **結果統合**: 各サブタスクの結果を統合して最終結果を生成

### 3. 統合されたプロンプト処理 (`prepare-prompt.ts`)

- **自動検出**: オーケストレーションが必要なタスクを自動識別
- **シームレス統合**: 既存のブーメランタスク機能との共存

## 使用方法

### 環境変数の設定

```bash
export CLAUDE_AUTO_ORCHESTRATION=1
```

この環境変数を設定することで、自動オーケストレーション機能が有効になります。

### 基本的な使用例

#### 単純なタスク
```
ユーザー入力: "CSSファイルのスタイルを修正してください"
→ 自動判定: 単純なタスク
→ 実行モード: code
→ 直接実行
```

#### 複雑なタスク
```
ユーザー入力: "新しいユーザー認証システムを実装してください"
→ 自動判定: 複雑なタスク
→ サブタスク分解:
  1. architect - システム設計とアーキテクチャの策定
  2. code - 実装とコード開発
  3. debug - テストとデバッグの実行
→ 順次実行と結果統合
```

## タスク分析の詳細

### 複雑度判定基準

**高複雑度キーワード (スコア +3)**
- システム、アーキテクチャ、設計、実装、テスト、デバッグ
- フルスタック、データベース、API、セキュリティ、認証
- パフォーマンス、スケーラビリティ、マイクロサービス
- CI/CD、デプロイ、インフラ、クラウド、Docker、Kubernetes

**中複雑度キーワード (スコア +2)**
- コンポーネント、機能、モジュール、ライブラリ、フレームワーク
- UI、UX、フロントエンド、バックエンド、REST、GraphQL

**低複雑度キーワード (スコア +1)**
- バグ修正、スタイル、CSS、HTML、ドキュメント、README
- コメント、リファクタリング、最適化

### モード推奨ロジック

**architect モード**
- 設計、アーキテクチャ、構造、計画、システム設計
- データベース設計、API設計、要件定義、仕様書

**code モード**
- 実装、コード、プログラム、開発、作成、構築
- ファイル作成、クラス、関数、メソッド

**debug モード**
- デバッグ、バグ、エラー、問題、修正、トラブルシューティング
- テスト、検証、確認

**ask モード**
- 質問、説明、教えて、どうやって、なぜ、方法
- ヘルプ、サポート、情報、調査

**orchestrator モード**
- 複数、統合、連携、ワークフロー、パイプライン
- 自動化、オーケストレーション、管理

## サブタスク分解の例

### Webアプリケーション開発
```
入力: "新しいWebアプリケーションを開発してください"

サブタスク:
1. design (architect) - システム設計とアーキテクチャの策定
   - 優先度: 1
   - 依存関係: なし
   
2. implementation (code) - コードの実装と開発
   - 優先度: 2
   - 依存関係: design
   
3. testing (debug) - テストとデバッグの実行
   - 優先度: 3
   - 依存関係: implementation
   
4. documentation (ask) - ドキュメントの作成と説明
   - 優先度: 4
   - 依存関係: implementation
```

## 設定オプション

### OrchestrationConfig

```typescript
interface OrchestrationConfig {
  maxConcurrentTasks: number;    // 最大並行タスク数 (デフォルト: 3)
  timeoutMinutes: number;        // タイムアウト時間 (デフォルト: 30)
  retryAttempts: number;         // リトライ回数 (デフォルト: 2)
}
```

### カスタム設定例

```typescript
const orchestrator = createAutoOrchestrator({
  maxConcurrentTasks: 5,
  timeoutMinutes: 60,
  retryAttempts: 3,
});
```

## 出力形式

### 成功時の出力例

```markdown
# 自動オーケストレーション結果

## 実行サマリー
- 完了したタスク: 3
- 失敗したタスク: 0
- 成功率: 100%

## 完了したタスク
### design (architectモード)
- 説明: システム設計とアーキテクチャの策定
- 結果: architectモードでタスク「システム設計とアーキテクチャの策定」を完了しました。

### implementation (codeモード)
- 説明: コードの実装と開発
- 結果: codeモードでタスク「コードの実装と開発」を完了しました。

### testing (debugモード)
- 説明: テストとデバッグの実行
- 結果: debugモードでタスク「テストとデバッグの実行」を完了しました。

## 統合結果
architectモードでタスク「システム設計とアーキテクチャの策定」を完了しました。

codeモードでタスク「コードの実装と開発」を完了しました。

debugモードでタスク「テストとデバッグの実行」を完了しました。
```

## トラブルシューティング

### よくある問題

1. **環境変数が設定されていない**
   - `CLAUDE_AUTO_ORCHESTRATION=1` が設定されているか確認

2. **タスクが単純すぎる**
   - 複雑度スコアが5未満の場合、オーケストレーションは実行されません

3. **依存関係エラー**
   - サブタスクの依存関係が循環していないか確認

### デバッグ情報

オーケストレーション実行時には以下の情報がログ出力されます：

```
🎯 タスクの自動分析を開始: [タスク説明]
📝 単純なタスクとして処理: [モード]モード
🔄 複雑なタスクを[N]個のサブタスクに分解
🚀 サブタスク実行開始: [ID] ([モード]モード)
✅ サブタスク完了: [ID]
❌ サブタスク失敗: [ID]
🔄 リトライ [回数]/[最大回数]: [ID]
✅ オーケストレーション完了 ([時間]ms)
```

## API リファレンス

### 主要な関数とクラス

- `analyzeTask(taskDescription: string): TaskAnalysisResult`
- `createAutoOrchestrator(config?: Partial<OrchestrationConfig>): AutoOrchestrator`
- `AutoOrchestrator.orchestrateTask(taskDescription: string): Promise<OrchestrationResult>`

詳細な型定義については、各ソースファイルのTypeScript型定義を参照してください。