# コミットハッシュ出力機能

この機能は、Claude Code Actionが実行するすべてのプロンプトに対して、自動的に「コミットを行った場合、コミットハッシュを出力してください」という指示を追加します。

## 機能概要

- すべてのプロンプト（インライン・ファイルベース）に自動的にコミットハッシュ出力指示を追加
- Claudeがコミットを作成した際に、コミットハッシュを出力するよう促す
- シンプルで確実な実装

## 実装詳細

### 修正ファイル

**`src/prepare-prompt.ts`**
- `createTemporaryPromptFile()` 関数を修正してコミット指示を自動追加
- インラインプロンプトとファイルベースプロンプトの両方に対応
- 元のプロンプト内容の末尾に指示を追加

### 追加される指示

```
重要: コミットを行った場合、コミットハッシュを出力してください。コミットハッシュは完全な40文字の形式で出力し、バッククォートやコードブロックで囲まないでください。
```

## 動作フロー

1. ユーザーがプロンプトを提供（インラインまたはファイル）
2. `preparePrompt()` 関数が呼び出される
3. `createTemporaryPromptFile()` でプロンプトファイルを作成する際に、コミット指示を自動追加
4. Claudeが拡張されたプロンプトを受け取る
5. Claudeがコミットを作成した場合、コミットハッシュを出力

## 対応ケース

### インラインプロンプト
```yaml
- uses: tools-angoya/claude-code-base-action@main
  with:
    prompt: "バグを修正してください"
```

実際にClaudeが受け取るプロンプト：
```
バグを修正してください

重要: コミットを行った場合、コミットハッシュを出力してください。コミットハッシュは完全な40文字の形式で出力し、バッククォートやコードブロックで囲まないでください。
```

### ファイルベースプロンプト
```yaml
- uses: tools-angoya/claude-code-base-action@main
  with:
    prompt_file: "prompts/fix-bug.txt"
```

`fix-bug.txt` の内容：
```
詳細なバグ修正の指示...
```

実際にClaudeが受け取るプロンプト：
```
詳細なバグ修正の指示...

重要: コミットを行った場合、コミットハッシュを出力してください。コミットハッシュは完全な40文字の形式で出力し、バッククォートやコードブロックで囲まないでください。
```

## ブーメランタスクとの互換性

この機能は以下の機能と完全に互換性があります：
- ブーメランタスク
- 自動オーケストレーション
- カスタムモード

すべてのケースで、最終的なプロンプトにコミットハッシュ出力指示が追加されます。

## テスト

`test/commit-hash-instruction.test.ts` にユニットテストが含まれています：

- インラインプロンプトへの指示追加
- ファイルベースプロンプトへの指示追加
- エラーケースの適切な処理

## 利点

1. **シンプル**: 複雑なログ解析や後処理が不要
2. **確実**: すべてのプロンプトに自動的に追加
3. **非侵入的**: 既存の機能に影響を与えない
4. **保守性**: 最小限の変更で実装

## 使用例

Claudeがコミットを作成した場合の出力例：
```
ファイルを修正しました。

git add .
git commit -m "fix: resolve null pointer exception"

コミットハッシュ: a1b2c3d4e5f6789012345678901234567890abcd
```

この出力により、ユーザーは作成されたコミットのハッシュを簡単に確認でき、GitHubのコメントでコミットハッシュが自動的にリンクとして表示されます。